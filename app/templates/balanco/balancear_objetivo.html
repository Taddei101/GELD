{% extends "base.html" %}

{% block title %}Balancear Aporte - {{ objetivo.nome_objetivo }}{% endblock %}

{% block header %}Balancear Aporte: {{ objetivo.nome_objetivo }}{% endblock %}

{% block content %}
<div class="container">
    
    <!-- InformaÃ§Ãµes do Objetivo -->
    <div class="card mb-4">
        <div class="card-body">
            <h5>InformaÃ§Ãµes do Objetivo</h5>
            <div class="row">
                <div class="col-md-3">
                    <strong>Cliente:</strong> {{ cliente.nome }}
                </div>
                <div class="col-md-3">
                    <strong>Tipo:</strong> 
                    <span class="badge-tipo-objetivo {{ 'badge-previdencia' if objetivo.tipo_objetivo.value == 'previdencia' else 'badge-geral' }}">
                        {{ objetivo.tipo_objetivo.value.title() }}
                    </span>
                </div>
                <div class="col-md-3">
                    <strong>DuraÃ§Ã£o:</strong> {{ objetivo.duracao_meses }} meses
                </div>
                <div class="col-md-3">
                    <strong>Montante Atual:</strong> R$ {{ '{:,.2f}'.format(objetivo.valor_real).replace(',', ' ').replace('.', ',').replace(' ', '.') }}
                </div>
            </div>
        </div>
    </div>

    {% if not resultado %}
    <!-- FormulÃ¡rio para informar o valor do aporte -->
    <div class="card">
        <div class="card-body">
            <h5>Informe o Valor do Aporte</h5>
            <form method="post" action="{{ url_for('balancos.balancear_objetivo', objetivo_id=objetivo.id) }}">
                <div class="form-group">
                    <label for="aporte">Valor do Aporte (R$):</label>
                    <input type="number" 
                           step="0.01" 
                           min="0.01" 
                           name="aporte" 
                           id="aporte" 
                           class="form-control" 
                           placeholder="Ex: 5000.00"
                           required
                           autofocus>
                </div>
                <p></p>
                <button type="submit" class="bigBtn">
                    <img src="{{ url_for('static', filename='icons/balance.png') }}" class="btn-icon">
                    Calcular Balanceamento
                </button>
            </form>
        </div>
    </div>

    {% else %}
    <!-- ExibiÃ§Ã£o dos Resultados -->
    <div class="card mb-3">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Resultado do Balanceamento</h5>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-4">
                    <strong>Valor Total:</strong> 
                    <span class="h5">R$ {{ '{:,.2f}'.format(resultado.total).replace(',', ' ').replace('.', ',').replace(' ', '.') }}</span>
                </div>
                <div class="col-md-4">
                    <strong>DuraÃ§Ã£o Real:</strong> {{ resultado.periodo_meses }} meses
                </div>
                <div class="col-md-4">
                    <strong>DuraÃ§Ã£o de ReferÃªncia:</strong> {{ resultado.duracao_referencia }} meses
                </div>
            </div>
        </div>
    </div>

    <!-- Cards de DistribuiÃ§Ã£o por Risco -->
    <div class="row">
        <!-- Risco Baixo -->
        <div class="col-md-4 mb-3">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0">ðŸŸ¢ Risco Baixo</h6>
                </div>
                <div class="card-body">
                    <h4 class="text-success">
                        R$ {{ '{:,.2f}'.format(resultado.risco.baixo.valor).replace(',', ' ').replace('.', ',').replace(' ', '.') }}
                    </h4>
                    <p class="mb-3">
                        <strong>{{ '{:.2f}'.format(resultado.risco.baixo.percentual) }}%</strong> do total
                    </p>
                    
                    <hr>
                    
                    <h6>SubdivisÃ£o:</h6>
                    <div class="mb-2">
                        <strong>DI ({{ '{:.2f}'.format(resultado.risco.baixo.subdivisao.di.percentual) }}%):</strong>
                        <br>
                        <span class="text-muted">
                            R$ {{ '{:,.2f}'.format(resultado.risco.baixo.subdivisao.di.valor).replace(',', ' ').replace('.', ',').replace(' ', '.') }}
                        </span>
                    </div>
                    <div>
                        <strong>RFX ({{ '{:.2f}'.format(resultado.risco.baixo.subdivisao.rfx.percentual) }}%):</strong>
                        <br>
                        <span class="text-muted">
                            R$ {{ '{:,.2f}'.format(resultado.risco.baixo.subdivisao.rfx.valor).replace(',', ' ').replace('.', ',').replace(' ', '.') }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risco Moderado -->
        <div class="col-md-4 mb-3">
            <div class="card border-warning">
                <div class="card-header bg-warning">
                    <h6 class="mb-0">ðŸŸ¡ Risco Moderado</h6>
                </div>
                <div class="card-body">
                    <h4 class="text-warning">
                        R$ {{ '{:,.2f}'.format(resultado.risco.moderado.valor).replace(',', ' ').replace('.', ',').replace(' ', '.') }}
                    </h4>
                    <p class="mb-0">
                        <strong>{{ '{:.2f}'.format(resultado.risco.moderado.percentual) }}%</strong> do total
                    </p>
                </div>
            </div>
        </div>

        <!-- Risco Alto -->
        <div class="col-md-4 mb-3">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h6 class="mb-0">ðŸ”´ Risco Alto</h6>
                </div>
                <div class="card-body">
                    <h4 class="text-danger">
                        R$ {{ '{:,.2f}'.format(resultado.risco.alto.valor).replace(',', ' ').replace('.', ',').replace(' ', '.') }}
                    </h4>
                    <p class="mb-0">
                        <strong>{{ '{:.2f}'.format(resultado.risco.alto.percentual) }}%</strong> do total
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabela Resumo -->
    <div class="card">
        <div class="card-header">
            <h6 class="mb-0">Resumo da DistribuiÃ§Ã£o</h6>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Categoria</th>
                        <th>Percentual</th>
                        <th>Valor (R$)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Risco Baixo</strong></td>
                        <td>{{ '{:.2f}'.format(resultado.risco.baixo.percentual) }}%</td>
                        <td>R$ {{ '{:,.2f}'.format(resultado.risco.baixo.valor).replace(',', ' ').replace('.', ',').replace(' ', '.') }}</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 30px;">â†³ DI</td>
                        <td>{{ '{:.2f}'.format(resultado.risco.baixo.subdivisao.di.percentual) }}%</td>
                        <td>R$ {{ '{:,.2f}'.format(resultado.risco.baixo.subdivisao.di.valor).replace(',', ' ').replace('.', ',').replace(' ', '.') }}</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 30px;">â†³ RFX</td>
                        <td>{{ '{:.2f}'.format(resultado.risco.baixo.subdivisao.rfx.percentual) }}%</td>
                        <td>R$ {{ '{:,.2f}'.format(resultado.risco.baixo.subdivisao.rfx.valor).replace(',', ' ').replace('.', ',').replace(' ', '.') }}</td>
                    </tr>
                    <tr>
                        <td><strong>Risco Moderado</strong></td>
                        <td>{{ '{:.2f}'.format(resultado.risco.moderado.percentual) }}%</td>
                        <td>R$ {{ '{:,.2f}'.format(resultado.risco.moderado.valor).replace(',', ' ').replace('.', ',').replace(' ', '.') }}</td>
                    </tr>
                    <tr>
                        <td><strong>Risco Alto</strong></td>
                        <td>{{ '{:.2f}'.format(resultado.risco.alto.percentual) }}%</td>
                        <td>R$ {{ '{:,.2f}'.format(resultado.risco.alto.valor).replace(',', ' ').replace('.', ',').replace(' ', '.') }}</td>
                    </tr>
                    <tr class="table-active">
                        <td><strong>TOTAL</strong></td>
                        <td><strong>100.00%</strong></td>
                        <td><strong>R$ {{ '{:,.2f}'.format(resultado.total).replace(',', ' ').replace('.', ',').replace(' ', '.') }}</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- BotÃµes de AÃ§Ã£o -->
    <div class="mt-4">
        <button class="bigBtn" onclick="window.location.href='{{ url_for('balancos.balancear_objetivo', objetivo_id=objetivo.id) }}'">
            <img src="{{ url_for('static', filename='icons/balance.png') }}" class="btn-icon">
            Novo CÃ¡lculo
        </button>
        
        <button title="Voltar" class="smlBtn" onclick="window.location.href='{{ url_for('objetivo.listar_objetivos', cliente_id=cliente.id) }}'">
            <img src="{{ url_for('static', filename='icons/back.png') }}" class="sml-btn-icon">
        </button>
    </div>
    {% endif %}

</div>
{% endblock %}
